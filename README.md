#  Репликация postgres

## Цели: 
Научиться настраивать репликацию и создавать резервные копии в СУБД PostgreSQL

## Задачи домашнего задания:
1) Настроить hot_standby репликацию с использованием слотов
2) Настроить правильное резервное копирование

### Описание домашнего задания
После запуска vagrant поднимет 3 хоста:
1) node1 - мастер сервер для репликации;
2) node2 - слэйв сервер для репликации;
3) barman - сервер бэкапов.

#### Проверка задания
1) Проверка репликации
В ходе разворачивание ansible добавил новую таблицу: otus.

Заходим на node2 для проверки репликации:
```vagrant ssh node2```

Затем через рута заходим в пользователя postgres:

```sudo -i```

```su postgres```

Открываем postgresql:
```psql```
Проверяем наличие базы:
```\l```

2) Проверка бэкапа

Для проверки бэкапа заходим на barman:
```vagrant ssh barman```

Переходим в рута:
```sudo -i```

Проверяем ноду:
```barman check node1```

И делаем бэкап:
```barman backup node1```

Заходим на node1 и открываем базу postgres(смотри шаги выше)

Удаляем базу otus:
```drop database otus;```

Останавливаем mysql на node1 для выполнения бэкапа
```systemctcl stop postgresql```

Cмотрим id бэкапа на barman:
```barman list-backup node1```

Выполняем бэкап:
```barman recover node1 <вставить id бэкапа> /var/lib/postgresql/13/main/ --remote-ssh-command "ssh postgres@192.168.50.10"```

Снова заходим на node1 стартуем postgresql и проверяем наличие удаленной базы.
